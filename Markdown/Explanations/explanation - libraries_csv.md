---
created: 2025-08-26T08:16
updated: 2025-08-26T08:17
---
# Explanation of the `libraries.csv` File and its Usage in Cell Ranger ARC

This document explains the purpose, structure, and usage of the `libraries.csv` file, which is a critical input for the `cellranger-arc count` pipeline when processing 10x Genomics Multiome ATAC + Gene Expression data.

## What is `libraries.csv`?

The `libraries.csv` file is a plain text, comma-separated values (CSV) file that serves as a manifest for the input FASTQ data for `cellranger-arc count`. It explicitly tells the `cellranger-arc` pipeline which FASTQ files belong to which library (e.g., Gene Expression or Chromatin Accessibility) and how they should be processed.

For Multiome experiments, `cellranger-arc` requires both Gene Expression (GEX) and Chromatin Accessibility (ATAC) libraries to be specified, even if only one type of data is being analyzed (as was the case in our initial attempts). This is because `cellranger-arc` is designed to analyze these two modalities together from the same cells.

## Structure of `libraries.csv`

The `libraries.csv` file must contain a header row with specific column names, followed by one or more data rows, each representing a single library.

**Header:**

The required header columns are:

*   `fastqs`: The absolute path to the directory containing the demultiplexed FASTQ files for a given sample.
*   `sample`: The sample name, which should match the sample name assigned during demultiplexing (e.g., in the `bcl2fastq` sample sheet).
*   `library_type`: The type of library. For Multiome data, this must be either `"Gene Expression"` or `"Chromatin Accessibility"`. These values are case-sensitive.

**Example `libraries.csv` (as generated by the script):**

```csv
fastqs,sample,library_type
/beegfs/scratch/ric.sessa/kubacki.michal/SRF_Linda/ATAC_data/cellranger_atac_arcv1_output_fixed/R26-Nestin-Mut-adult_fastq,R26-Nestin-Mut-adult,"Chromatin Accessibility"
/beegfs/scratch/ric.sessa/kubacki.michal/SRF_Linda/ATAC_data/cellranger_atac_arcv1_output_fixed/R26-Nestin-Mut-adult_fastq,R26-Nestin-Mut-adult,"Gene Expression"
```

In this example:

*   The `fastqs` column points to the directory where the symbolic links to the processed FASTQ files are located.
*   The `sample` column specifies the sample ID (`R26-Nestin-Mut-adult`).
*   There are two entries for the same sample, one for `"Chromatin Accessibility"` (ATAC) and one for `"Gene Expression"` (GEX), as required by `cellranger-arc` for Multiome data.

## How `libraries.csv` is Used by `cellranger-arc`

The `libraries.csv` file is passed to the `cellranger-arc count` pipeline using the `--libraries` flag:

```bash
"$CELLRANGER_ARC" count \
    --id="$UNIQUE_ID" \
    --reference="$REF" \
    --libraries="$LIBRARIES_CSV" \
    --localcores="$SLURM_CPUS_PER_TASK" \
    --localmem="$CELLRANGER_MEM_GB" \
    --disable-ui
```

When `cellranger-arc count` receives this file, it performs the following actions:

1.  **Identifies Libraries:** It reads each row of the `libraries.csv` to identify the different libraries associated with the experiment.
2.  **Locates FASTQ Files:** For each library, it uses the `fastqs` path to locate the corresponding FASTQ files. It expects these files to follow the `bcl2fastq` naming conventions (e.g., `[Sample Name]_S1_L001_[Read Type]_001.fastq.gz`).
3.  **Determines Processing Workflow:** Based on the `library_type` (e.g., "Chromatin Accessibility" or "Gene Expression"), `cellranger-arc` applies the appropriate processing algorithms for that modality.
4.  **Integrates Multiome Data:** For Multiome experiments, `cellranger-arc` uses both the ATAC and GEX libraries to perform joint analysis, including cell calling, dimensionality reduction, clustering, and feature linkage.

## Importance of Correct `libraries.csv`

Using a correctly formatted `libraries.csv` is paramount for successful `cellranger-arc` analysis. Errors in this file, such as incorrect headers, paths, sample names, or library types, will cause the pipeline to fail.